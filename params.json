{"name":"Curriculum","tagline":"Curriculum for the ClojureBridge workshop series.","body":"# Web App Notes\r\n\r\n\r\n## Set up your app\r\n\r\n```bash\r\nlein new compojure chat\r\ncd chat\r\nlein ring server\r\n```\r\n\r\nThis should create a directory structure that looks like this:\r\n\r\n```\r\n| .gitignore\r\n| project.clj\r\n| resources\r\n| | public\r\n| README.md\r\n| target\r\n| src\r\n| | chat\r\n| | | handler.clj\r\n| test\r\n| | chat\r\n| | | test\r\n| | | | handler.clj\r\n```\r\n\r\nThere's nothing inherently special or Clojure-y about this project skeleton. It's just a convention used by Leiningen. You'll be using Leiningen to build and run Clojure apps, and Leiningen expects your app to be laid out this way. Here's the function of each part of the skeleton:\r\n\r\n- `project.clj` is a configuration file for Leiningen. It helps\r\n  Leiningen answer questions like, \"What dependencies does this\r\n  project have?\" and \"When this Clojure program runs, what function\r\n  should get executed first?\"\r\n- `src/chat/handler.clj` is where we'll be doing our\r\n  Clojure coding for awhile.\r\n- The `test` directory contains tests, which we won't be covering.\r\n- `resources` is a place for you to store assets like images; we won't\r\n  be using it today.\r\n\r\nNow let's go ahead and actually run this project. Enter this at the command line:\r\n\r\n## Say hello to yourself\r\n\r\nOpen up your Chat application in LightTable. In LightTable open ```chat/src/chat.handler.clj```.\r\n\r\nChange the ```(GET \"/\" ...``` line to say hello to yourself\r\n\r\n```clojure\r\n  (GET \"/\" [] \"Hello YourName!\")\r\n```\r\n\r\nView your page at <a href=\"http://localhost:3000/\">http://localhost:3000/</a>.\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/68695029d7933fc0272b4cd5d541ff9473db340b)\r\n\r\n\r\n## Write some html with Hiccup\r\n\r\nUnder the ```(GET \"/\" ...``` line, add a new route like this:\r\n\r\n```clojure\r\n  (GET \"/hello2\" [] (page/html5 [:div \"Hello from \" [:b \"hiccup\"] \"!\"]))\r\n```\r\n\r\nIf you save the file, you'll get an error in your console because Clojure doesn't know what Hiccup is yet. We'll need to add hiccup to our ```project.clj``` file and require it in ```src/chat/handler.clj```.\r\n\r\n```clojure\r\n; add this to the ```:dependencies``` section of project.clj\r\n[hiccup \"1.0.5\"]\r\n```\r\nBecause we've changed our ```project.clj``` file, you'll need to restart your server (press ```ctrl-c``` to stop it and then run the same command you ran before to start it again)\r\n\r\n```clojure\r\n; add this to the ```:require``` section at the top of handler.clj\r\n[hiccup.page :as page]\r\n```\r\n![diff](img/project_hiccup_dependencies.png)\r\n![diff](img/handler_require.png)\r\n\r\nView your page at http://localhost:3000/hello2\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/a5eb7cb2c6753cda053c716bc740fe6fdce5f9de)\r\n\r\n\r\n## Add a form\r\n\r\nAdd a new item in ```:require```\r\n\r\n```clojure\r\n[hiccup.form :as form]\r\n```\r\n\r\nAdd a new route for rendering a form that calls a function to make the page\r\n\r\n```clojure\r\n; add a function (Note: this must be before the defroutes section\r\n(defn who []\r\n  (page/html5\r\n    (form/form-to [:post \"/iam\"]\r\n                  [:label \"Who are you?\"]\r\n                  (form/text-field \"name\")\r\n                  (form/submit-button \"Submit\"))))\r\n\r\n; add a route to the defroutes section\r\n(GET \"/who\" [] (who))\r\n```\r\n\r\nView your page at http://localhost:3000/who. If you submit the form, you'll get an error, so we need to handle the post like this:\r\n\r\n```clojure\r\n; make a function to display our response\r\n(defn iam [params]\r\n  (page/html5\r\n    [:div \"You are \" (:name params) \"!\"]))\r\n\r\n; add a route to handle the request\r\n(POST \"/iam\" {params :params} (iam params))\r\n```\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/fda95cd021e832f8230d7eded8240488fb80d89f)\r\n\r\n\r\n## Add some flow control\r\n\r\n```clojure\r\n; change the iam function to look like this\r\n(defn iam [params]\r\n  (page/html5\r\n    [:div \"You are \" (:name params) \"!\"\r\n     [:ul\r\n      [:li \"Your name is \" (if (odd? (count (:name params)))\r\n                             \"odd\"\r\n                             \"even\")]\r\n      (when (> (count (:name params)) 7)\r\n          [:li \"You should consider a nickname.\"])]]))\r\n```\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/705227c000454f18c0f1ac7bba79bcf7f71e627a)\r\n\r\n\r\n## Simplify things with ```let```\r\n\r\nThat's nice, but we've written ```(:name params)``` a lot. Change the function to use a ```var```:\r\n\r\n```clojure\r\n; change the iam function to look like this\r\n(defn iam [params]\r\n  (page/html5\r\n    (let [name (:name params)]\r\n      [:div \"You are \" name \"!\"\r\n       [:ul\r\n        [:li \"Your name is \" (if (odd? (count name))\r\n                               \"odd\"\r\n                               \"even\")]\r\n        (when (> (count name) 7)\r\n            [:li \"You should consider a nickname.\"])]])))\r\n```\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/4bf28482e4b6c72bba1c6b635a1e30b2fd9f9879)\r\n\r\n\r\n## Maps\r\n\r\nWe can look at our params map by printing it out. Change the ```iam``` function to this:\r\n\r\n```clojure\r\n; change the iam function to look like this\r\n(defn iam [params]\r\n  (page/html5\r\n    (let [name (:name params)]\r\n      [:div \"You are \" name \"!\"\r\n       [:ul\r\n        [:li (str params)]\r\n        [:li \"Your name is \" (if (odd? (count name))\r\n                               \"odd\"\r\n                               \"even\")]\r\n        (when (> (count name) 7)\r\n            [:li \"You should consider a nickname.\"])]])))\r\n```\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/9dcfa8cf5577c6fa65d7f8141d7788a5e56d1add)\r\n\r\n\r\n## Post a name and message\r\n\r\n```clojure\r\n; change our default route to this (be sure to not leave the old version around - it will cause problems)\r\n(ANY \"/\" {params :params} (chat (:name params) (:msg params)))\r\n\r\n; add a chat function\r\n(defn chat [name msg]\r\n  (page/html5\r\n   (form/form-to\r\n    [:post \"/\"]\r\n    [:div \"Name:\" (form/text-field \"name\" name) \" Message:\" (form/text-field \"msg\")]\r\n    (form/submit-button \"Submit\"))))\r\n```\r\n\r\nView your app and submit a name and a message. Notice that the name is still there when you\r\nsubmit the page.\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/0af9ad31c50d8bd8552df759ec6dfdba35b7dbb7)\r\n\r\n\r\n## Store and display messages\r\n\r\nFirst, add an atom so we can store our messages somewhere.\r\n\r\n```clojure\r\n; above the chat function\r\n(def messages (atom []))\r\n```\r\n\r\nNext, update our messages atom and print them out\r\n\r\n```clojure\r\n(defn chat [name msg]\r\n  (when-not (empty? msg)\r\n    (swap! messages conj [name msg]))\r\n  (page/html5\r\n    (map (fn [message] [:div [:strong (first message)] \" \" (second message)]) @messages)\r\n    (form/form-to\r\n      ; leave the rest of the function the same as it was..\r\n```\r\n\r\nTry using your app to chat with someone\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/7350384b5f97dc618a4e81a175e8bfaf12c629e1)\r\n\r\n\r\n## Make it pretty by adding Bootstrap\r\n\r\nAdd Bootstrap to our project by adding this dependency in your ```project.clj``` file:\r\n\r\n```clojure\r\n[hiccup-bootstrap \"0.1.2\"]\r\n```\r\nDon't forget to restart your server after making a change to ```project.clj```.\r\n\r\nAdd some code to make Bootstrap work in your ```src/chat/handler.clj``` file:\r\n\r\n```clojure\r\n; Add these two lines to use Bootstrap middleware. Put them at the top after the hiccup.form line:\r\n[hiccup.bootstrap.middleware :as middleware]\r\n[hiccup.bootstrap.page :as boot]\r\n\r\n; modify our chat function to use Bootstrap\r\n(defn chat [name msg]\r\n  (when-not (empty? msg)\r\n    (swap! messages conj [name msg]))\r\n  (page/html5\r\n   [:head                         ;added\r\n    [:title \"Chat\"]                         ;added\r\n    (boot/include-bootstrap)]               ;added\r\n   [:body                                   ;added\r\n     [:h1 \"Chat\"]                           ;added\r\n     [:div.well\r\n      (map (fn [message] [:div [:strong (first message)] \" \" (second message)]) @messages)]\r\n     (form/form-to\r\n      [:post \"/\"]\r\n      [:div \"Name:\" (form/text-field \"name\" name) \" Message:\" (form/text-field \"msg\")]\r\n      (form/submit-button \"Submit\"))]))     ;changed\r\n\r\n; add the Bootstrap specific routes by wrapping our routes with them\r\n(def app\r\n  (handler/site (middleware/wrap-bootstrap-resources app-routes)))\r\n```\r\n\r\n[commit](https://github.com/clojurebridge-minneapolis/chat/commit/a518836ff9b7e0016d006051fd88dd707ffcdbe7)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}